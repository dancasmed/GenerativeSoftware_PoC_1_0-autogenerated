{
  "choices": [
    {
      "message": {
        "content": "\u0060\u0060\u0060json\n{\n  \u0022isFeatureImplemented\u0022: false,\n  \u0022updatedSourceCodeFiles\u0022: [\n    {\n      \u0022filename\u0022: \u0022Module.cs\u0022,\n      \u0022source_code\u0022: \u0022using SelfEvolvingSoftware.Interfaces;\\nusing System;\\nusing System.Collections.Generic;\\nusing System.IO;\\nusing System.Text.Json;\\nusing System.Linq;\\n\\npublic class Meal\\n{\\n    public string Id { get; set; }\\n    public string Name { get; set; }\\n    public string Description { get; set; }\\n    public List\u003CIngredient\u003E Ingredients { get; set; }\\n    public int Calories { get; set; }\\n    public int PreparationTime { get; set; }\\n    public List\u003Cstring\u003E DietaryTags { get; set; }\\n}\\n\\npublic class Ingredient\\n{\\n    public string Id { get; set; }\\n    public string Name { get; set; }\\n    public string Category { get; set; }\\n    public double Quantity { get; set; }\\n    public string Unit { get; set; }\\n}\\n\\npublic class MealPlan\\n{\\n    public string Id { get; set; }\\n    public string UserId { get; set; }\\n    public DateTime StartDate { get; set; }\\n    public DateTime EndDate { get; set; }\\n    public List\u003CDay\u003E Days { get; set; }\\n}\\n\\npublic class Day\\n{\\n    public DateTime Date { get; set; }\\n    public List\u003CMeal\u003E Meals { get; set; }\\n    public int TotalCalories { get; set; }\\n}\\n\\npublic class GroceryList\\n{\\n    public string Id { get; set; }\\n    public string MealPlanId { get; set; }\\n    public List\u003CGroceryItem\u003E Items { get; set; }\\n    public int TotalItems { get; set; }\\n}\\n\\npublic class GroceryItem\\n{\\n    public string Id { get; set; }\\n    public string IngredientId { get; set; }\\n    public string Name { get; set; }\\n    public string Category { get; set; }\\n    public double Quantity { get; set; }\\n    public string Unit { get; set; }\\n    public bool Checked { get; set; }\\n}\\n\\npublic class User\\n{\\n    public string Id { get; set; }\\n    public string Name { get; set; }\\n    public List\u003Cstring\u003E DietaryPreferences { get; set; }\\n    public List\u003Cstring\u003E DietaryRestrictions { get; set; }\\n    public int CalorieTarget { get; set; }\\n}\\n\\npublic class DataStorage\\n{\\n    private string dataFolder;\\n    private JsonSerializerOptions jsonOptions;\\n\\n    public DataStorage(string folder)\\n    {\\n        dataFolder = folder;\\n        jsonOptions = new JsonSerializerOptions { WriteIndented = true, PropertyNameCaseInsensitive = true };\\n    }\\n\\n    public List\u003CUser\u003E LoadUsers() =\u003E Load\u003CList\u003CUser\u003E\u003E(\\\u0022users.json\\\u0022);\\n    public List\u003CMeal\u003E LoadMeals() =\u003E Load\u003CList\u003CMeal\u003E\u003E(\\\u0022meals.json\\\u0022);\\n    public List\u003CMealPlan\u003E LoadMealPlans() =\u003E Load\u003CList\u003CMealPlan\u003E\u003E(\\\u0022mealplans.json\\\u0022);\\n    public List\u003CGroceryList\u003E LoadGroceryLists() =\u003E Load\u003CList\u003CGroceryList\u003E\u003E(\\\u0022grocerylists.json\\\u0022);\\n\\n    public void SaveUsers(List\u003CUser\u003E data) =\u003E Save(\\\u0022users.json\\\u0022, data);\\n    public void SaveMeals(List\u003CMeal\u003E data) =\u003E Save(\\\u0022meals.json\\\u0022, data);\\n    public void SaveMealPlans(List\u003CMealPlan\u003E data) =\u003E Save(\\\u0022mealplans.json\\\u0022, data);\\n    public void SaveGroceryLists(List\u003CGroceryList\u003E data) =\u003E Save(\\\u0022grocerylists.json\\\u0022, data);\\n\\n    private T Load\u003CT\u003E(string filename) where T : new()\\n    {\\n        string path = Path.Combine(dataFolder, filename);\\n        if (File.Exists(path))\\n            return JsonSerializer.Deserialize\u003CT\u003E(File.ReadAllText(path), jsonOptions);\\n        return new T();\\n    }\\n\\n    private void Save\u003CT\u003E(string filename, T data)\\n    {\\n        string path = Path.Combine(dataFolder, filename);\\n        File.WriteAllText(path, JsonSerializer.Serialize(data, jsonOptions));\\n    }\\n}\\n\\npublic class MealPlannerModule : IGeneratedModule\\n{\\n    public string Name { get; set; } = \\\u0022Meal Planner Module\\\u0022;\\n    private DataStorage dataStorage;\\n    private User currentUser;\\n    private List\u003CMeal\u003E meals;\\n    private List\u003CMealPlan\u003E mealPlans;\\n    private List\u003CGroceryList\u003E groceryLists;\\n\\n    public bool Main(string dataFolder)\\n    {\\n        Console.WriteLine(\\\u0022Meal Planner Module is running.\\\u0022);\\n        dataStorage = new DataStorage(dataFolder);\\n        LoadData();\\n        InitializeUser();\\n        MainMenu();\\n        return true;\\n    }\\n\\n    private void LoadData()\\n    {\\n        meals = dataStorage.LoadMeals();\\n        mealPlans = dataStorage.LoadMealPlans();\\n        groceryLists = dataStorage.LoadGroceryLists();\\n    }\\n\\n    private void SaveData()\\n    {\\n        dataStorage.SaveMeals(meals);\\n        dataStorage.SaveMealPlans(mealPlans);\\n        dataStorage.SaveGroceryLists(groceryLists);\\n    }\\n\\n    private void InitializeUser()\\n    {\\n        var users = dataStorage.LoadUsers();\\n        if (!users.Any())\\n        {\\n            currentUser = new User\\n            {\\n                Id = Guid.NewGuid().ToString(),\\n                Name = \\\u0022Default User\\\u0022,\\n                DietaryPreferences = new List\u003Cstring\u003E(),\\n                DietaryRestrictions = new List\u003Cstring\u003E(),\\n                CalorieTarget = 2000\\n            };\\n            users.Add(currentUser);\\n            dataStorage.SaveUsers(users);\\n        }\\n        else\\n        {\\n            currentUser = users.First();\\n        }\\n    }\\n\\n    private void MainMenu()\\n    {\\n        bool exit = false;\\n        while (!exit)\\n        {\\n            Console.WriteLine(\\\u0022\\\\nMain Menu:\\\u0022);\\n            Console.WriteLine(\\\u00221. Manage Meals\\\u0022);\\n            Console.WriteLine(\\\u00222. Manage Meal Plans\\\u0022);\\n            Console.WriteLine(\\\u00223. Generate Grocery List\\\u0022);\\n            Console.WriteLine(\\\u00224. View/Edit User Settings\\\u0022);\\n            Console.WriteLine(\\\u00225. Exit\\\u0022);\\n            Console.Write(\\\u0022Enter choice: \\\u0022);\\n\\n            switch (Console.ReadLine())\\n            {\\n                case \\\u00221\\\u0022: ManageMeals(); break;\\n                case \\\u00222\\\u0022: ManageMealPlans(); break;\\n                case \\\u00223\\\u0022: GenerateGroceryList(); break;\\n                case \\\u00224\\\u0022: ViewEditUserSettings(); break;\\n                case \\\u00225\\\u0022: exit = true; break;\\n                default: Console.WriteLine(\\\u0022Invalid option\\\u0022); break;\\n            }\\n        }\\n        SaveData();\\n    }\\n\\n    private void ManageMeals()\\n    {\\n        Console.WriteLine(\\\u0022\\\\nManage Meals:\\\u0022);\\n        Console.WriteLine(\\\u00221. Create Meal\\\u0022);\\n        Console.WriteLine(\\\u00222. List Meals\\\u0022);\\n        Console.Write(\\\u0022Enter choice: \\\u0022);\\n\\n        switch (Console.ReadLine())\\n        {\\n            case \\\u00221\\\u0022: CreateMeal(); break;\\n            case \\\u00222\\\u0022: ListMeals(); break;\\n            default: Console.WriteLine(\\\u0022Invalid option\\\u0022); break;\\n        }\\n    }\\n\\n    private void CreateMeal()\\n    {\\n        var meal = new Meal\\n        {\\n            Id = Guid.NewGuid().ToString(),\\n            Ingredients = new List\u003CIngredient\u003E()\\n        };\\n\\n        Console.Write(\\\u0022Enter meal name: \\\u0022);\\n        meal.Name = Console.ReadLine();\\n        Console.Write(\\\u0022Enter description: \\\u0022);\\n        meal.Description = Console.ReadLine();\\n        Console.Write(\\\u0022Enter calories: \\\u0022);\\n        int.TryParse(Console.ReadLine(), out int calories);\\n        meal.Calories = calories;\\n\\n        bool addingIngredients = true;\\n        while (addingIngredients)\\n        {\\n            var ingredient = new Ingredient\\n            {\\n                Id = Guid.NewGuid().ToString()\\n            };\\n            Console.Write(\\\u0022Enter ingredient name (or \u0027done\u0027 to finish): \\\u0022);\\n            var nameInput = Console.ReadLine();\\n            if (nameInput?.ToLower() == \\\u0022done\\\u0022) break;\\n\\n            ingredient.Name = nameInput;\\n            Console.Write(\\\u0022Enter category: \\\u0022);\\n            ingredient.Category = Console.ReadLine();\\n            Console.Write(\\\u0022Enter quantity: \\\u0022);\\n            double.TryParse(Console.ReadLine(), out double quantity);\\n            ingredient.Quantity = quantity;\\n            Console.Write(\\\u0022Enter unit: \\\u0022);\\n            ingredient.Unit = Console.ReadLine();\\n\\n            meal.Ingredients.Add(ingredient);\\n        }\\n\\n        meals.Add(meal);\\n        Console.WriteLine(\\\u0022Meal created successfully.\\\u0022);\\n    }\\n\\n    private void ListMeals()\\n    {\\n        Console.WriteLine(\\\u0022\\\\nAll Meals:\\\u0022);\\n        foreach (var meal in meals)\\n            Console.WriteLine($\\\u0022{meal.Name} - {meal.Calories} calories ({meal.Ingredients.Count} ingredients)\\\u0022);\\n    }\\n\\n    private void ManageMealPlans()\\n    {\\n        Console.WriteLine(\\\u0022\\\\nManage Meal Plans:\\\u0022);\\n        Console.WriteLine(\\\u00221. Create Meal Plan\\\u0022);\\n        Console.WriteLine(\\\u00222. View Meal Plans\\\u0022);\\n        Console.WriteLine(\\\u00223. Add Meals to Plan\\\u0022);\\n        Console.Write(\\\u0022Enter choice: \\\u0022);\\n\\n        switch (Console.ReadLine())\\n        {\\n            case \\\u00221\\\u0022: CreateMealPlan(); break;\\n            case \\\u00222\\\u0022: ViewMealPlans(); break;\\n            case \\\u00223\\\u0022: AddMealsToPlan(); break;\\n            default: Console.WriteLine(\\\u0022Invalid option\\\u0022); break;\\n        }\\n    }\\n\\n    private void CreateMealPlan()\\n    {\\n        var plan = new MealPlan\\n        {\\n            Id = Guid.NewGuid().ToString(),\\n            UserId = currentUser.Id,\\n            Days = new List\u003CDay\u003E()\\n        };\\n\\n        Console.Write(\\\u0022Enter start date (yyyy-mm-dd): \\\u0022);\\n        DateTime.TryParse(Console.ReadLine(), out DateTime startDate);\\n        plan.StartDate = startDate;\\n        plan.EndDate = startDate.AddDays(6);\\n\\n        // Initialize empty days\\n        for (int i = 0; i \u003C 7; i\u002B\u002B)\\n        {\\n            plan.Days.Add(new Day\\n            {\\n                Date = startDate.AddDays(i),\\n                Meals = new List\u003CMeal\u003E(),\\n                TotalCalories = 0\\n            });\\n        }\\n\\n        mealPlans.Add(plan);\\n        Console.WriteLine(\\\u0022Meal plan created for week starting \\\u0022 \u002B startDate.ToShortDateString());\\n    }\\n\\n    private void ViewMealPlans()\\n    {\\n        Console.WriteLine(\\\u0022\\\\nCurrent Meal Plans:\\\u0022);\\n        for (int i = 0; i \u003C mealPlans.Count; i\u002B\u002B)\\n        {\\n            Console.WriteLine($\\\u0022{i \u002B 1}. {mealPlans[i].StartDate.ToShortDateString()} to {mealPlans[i].EndDate.ToShortDateString()}\\\u0022);\\n        }\\n\\n        Console.Write(\\\u0022\\\\nSelect meal plan to view details (0 to cancel): \\\u0022);\\n        if (int.TryParse(Console.ReadLine(), out int selection) \u0026\u0026 selection \u003E 0 \u0026\u0026 selection \u003C= mealPlans.Count)\\n        {\\n            var selectedPlan = mealPlans[selection - 1];\\n            Console.WriteLine(\\\u0022\\\\nMeal Plan Details:\\\u0022);\\n            foreach (var day in selectedPlan.Days)\\n            {\\n                Console.WriteLine($\\\u0022{day.Date.ToShortDateString()}: {day.Meals.Count} meals - Total Calories: {day.TotalCalories} (Target: {currentUser.CalorieTarget})\\\u0022);\\n                foreach (var meal in day.Meals)\\n                {\\n                    Console.WriteLine($\\\u0022- {meal.Name} ({meal.Calories} calories)\\\u0022);\\n                }\\n                if (day.TotalCalories \u003E currentUser.CalorieTarget)\\n                {\\n                    Console.WriteLine(\\\u0022WARNING: Exceeds daily calorie target!\\\u0022);\\n                }\\n            }\\n        }\\n    }\\n\\n    private void AddMealsToPlan()\\n    {\\n        if (!mealPlans.Any())\\n        {\\n            Console.WriteLine(\\\u0022No meal plans available\\\u0022);\\n            return;\\n        }\\n\\n        Console.WriteLine(\\\u0022\\\\nSelect Meal Plan:\\\u0022);\\n        for (int i = 0; i \u003C mealPlans.Count; i\u002B\u002B)\\n        {\\n            Console.WriteLine($\\\u0022{i \u002B 1}. {mealPlans[i].StartDate.ToShortDateString()} to {mealPlans[i].EndDate.ToShortDateString()}\\\u0022);\\n        }\\n\\n        Console.Write(\\\u0022Enter selection: \\\u0022);\\n        if (!int.TryParse(Console.ReadLine(), out int planIndex) || planIndex \u003C 1 || planIndex \u003E mealPlans.Count)\\n        {\\n            Console.WriteLine(\\\u0022Invalid selection\\\u0022);\\n            return;\\n        }\\n\\n        var selectedPlan = mealPlans[planIndex - 1];\\n\\n        Console.WriteLine(\\\u0022\\\\nSelect Day:\\\u0022);\\n        for (int i = 0; i \u003C selectedPlan.Days.Count; i\u002B\u002B)\\n        {\\n            Console.WriteLine($\\\u0022{i \u002B 1}. {selectedPlan.Days[i].Date.ToShortDateString()}\\\u0022);\\n        }\\n\\n        Console.Write(\\\u0022Enter day number: \\\u0022);\\n        if (!int.TryParse(Console.ReadLine(), out int dayIndex) || dayIndex \u003C 1 || dayIndex \u003E selectedPlan.Days.Count)\\n        {\\n            Console.WriteLine(\\\u0022Invalid selection\\\u0022);\\n            return;\\n        }\\n\\n        var selectedDay = selectedPlan.Days[dayIndex - 1];\\n\\n        Console.WriteLine(\\\u0022\\\\nAvailable Meals:\\\u0022);\\n        for (int i = 0; i \u003C meals.Count; i\u002B\u002B)\\n        {\\n            Console.WriteLine($\\\u0022{i \u002B 1}. {meals[i].Name} ({meals[i].Calories} calories)\\\u0022);\\n        }\\n\\n        Console.Write(\\\u0022Select meal to add (0 to finish): \\\u0022);\\n        while (int.TryParse(Console.ReadLine(), out int mealIndex))\\n        {\\n            if (mealIndex == 0) break;\\n            if (mealIndex \u003E 0 \u0026\u0026 mealIndex \u003C= meals.Count)\\n            {\\n                selectedDay.Meals.Add(meals[mealIndex - 1]);\\n                selectedDay.TotalCalories \u002B= meals[mealIndex - 1].Calories;\\n                Console.WriteLine($\\\u0022Added {meals[mealIndex - 1].Name} to {selectedDay.Date.ToShortDateString()}\\\u0022);\\n            }\\n            Console.Write(\\\u0022Select another meal (0 to finish): \\\u0022);\\n        }\\n    }\\n\\n    private void GenerateGroceryList()\\n    {\\n        if (!mealPlans.Any())\\n        {\\n            Console.WriteLine(\\\u0022No meal plans available\\\u0022);\\n            return;\\n        }\\n\\n        Console.WriteLine(\\\u0022\\\\nSelect Meal Plan:\\\u0022);\\n        for (int i = 0; i \u003C mealPlans.Count; i\u002B\u002B)\\n        {\\n            Console.WriteLine($\\\u0022{i \u002B 1}. {mealPlans[i].StartDate.ToShortDateString()} to {mealPlans[i].EndDate.ToShortDateString()}\\\u0022);\\n        }\\n\\n        Console.Write(\\\u0022Enter selection: \\\u0022);\\n        if (!int.TryParse(Console.ReadLine(), out int planIndex) || planIndex \u003C 1 || planIndex \u003E mealPlans.Count)\\n        {\\n            Console.WriteLine(\\\u0022Invalid selection\\\u0022);\\n            return;\\n        }\\n\\n        var plan = mealPlans[planIndex - 1];\\n\\n        var ingredients = plan.Days\\n            .SelectMany(d =\u003E d.Meals)\\n            .SelectMany(m =\u003E m.Ingredients)\\n            .GroupBy(i =\u003E i.Name)\\n            .Select(g =\u003E new GroceryItem\\n            {\\n                Id = Guid.NewGuid().ToString(),\\n                IngredientId = g.First().Id,\\n                Name = g.Key,\\n                Category = g.First().Category,\\n                Quantity = g.Sum(i =\u003E i.Quantity),\\n                Unit = g.First().Unit,\\n                Checked = false\\n            }).ToList();\\n\\n        var groceryList = new GroceryList\\n        {\\n            Id = Guid.NewGuid().ToString(),\\n            MealPlanId = plan.Id,\\n            Items = ingredients,\\n            TotalItems = ingredients.Count\\n        };\\n\\n        groceryLists.Add(groceryList);\\n        Console.WriteLine(\\\u0022\\\\nGrocery list generated with \\\u0022 \u002B ingredients.Count \u002B \\\u0022 items:\\\u0022);\\n        foreach (var item in ingredients)\\n        {\\n            Console.WriteLine($\\\u0022- {item.Quantity} {item.Unit} of {item.Name} ({item.Category})\\\u0022);\\n        }\\n    }\\n\\n    private void ViewEditUserSettings()\\n    {\\n        bool back = false;\\n        while (!back)\\n        {\\n            Console.WriteLine(\\\u0022\\\\nUser Settings:\\\u0022);\\n            Console.WriteLine(\\\u00221. View Current Settings\\\u0022);\\n            Console.WriteLine(\\\u00222. Edit Name\\\u0022);\\n            Console.WriteLine(\\\u00223. Edit Calorie Target\\\u0022);\\n            Console.WriteLine(\\\u00224. Manage Dietary Preferences\\\u0022);\\n            Console.WriteLine(\\\u00225. Manage Dietary Restrictions\\\u0022);\\n            Console.WriteLine(\\\u00226. Back to Main Menu\\\u0022);\\n            Console.Write"
      }
    }
  ]
}